<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Retail Net-Zero — Solar + PPA (CORE Markets)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />

  <!-- Set <base> to the CURRENT FOLDER so ./foo resolves correctly -->
  <script>
    (function () {
      var loc = window.location;
      // directory path with trailing slash (e.g., /USER/REPO/Projects/Retail-Net-Zero-Case-Study/)
      var dirPath = loc.pathname.endsWith('/') ? loc.pathname : loc.pathname.replace(/[^/]*$/, '');
      var base = document.createElement('base');
      base.href = loc.origin + dirPath;
      document.head.prepend(base);
    })();
  </script>

  <style>
    :root{
      --bg:#ffffff; --fg:#0f172a; --muted:#475569; --card:#f8fafc; --border:#e2e8f0;
      --accent:#2563eb; --accent-fg:#ffffff; --shadow:0 6px 24px rgba(15,23,42,.08),0 2px 8px rgba(15,23,42,.06);
      --maxw: 960px;
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b1220; --fg:#e5e7eb; --muted:#94a3b8; --card:#111827; --border:#1f2937; --accent:#60a5fa; --accent-fg:#0b1220; --shadow:0 6px 24px rgba(0,0,0,.5),0 2px 8px rgba(0,0,0,.4); }
    }
    *{box-sizing:border-box}
    body{margin:0; font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"; color:var(--fg); background:var(--bg)}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:28px 18px 72px}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:22px}
    .brand h1{margin:0; font-size:26px}
    .brand p{margin:6px 0 0; color:var(--muted)}
    .btn{display:inline-block; padding:8px 14px; border-radius:10px; border:1px solid var(--border); text-decoration:none; color:var(--fg)}
    .btn:hover{border-color:var(--accent)}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:18px; box-shadow:var(--shadow)}
    .hr{height:1px; background:var(--border); margin:24px 0}
    .content :where(h1,h2,h3){scroll-margin-top:80px}
    .grid{display:grid; gap:14px; grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
    .file{display:block; padding:14px; border-radius:14px; border:1px solid var(--border); background:var(--bg); text-decoration:none; color:inherit}
    .file:hover{border-color:var(--accent); box-shadow:var(--shadow); transform:translateY(-1px)}
    .file h3{margin:0 0 6px; font-size:16px}
    .file p{margin:0; color:var(--muted); font-size:13px}
    footer{margin-top:36px; color:var(--muted); font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Retail Net-Zero — Solar + PPA (CORE Markets)</h1>
        <p>Folder landing page • README rendered below • Quick links to files</p>
      </div>
      <div class="actions">
        <a class="btn" href="../">← Back to Portfolio</a>
      </div>
    </header>

    <!-- Quick links to files in this folder -->
    <section class="card">
      <h2 style="margin-top:0">Files in this folder</h2>
      <div class="grid" id="file-grid">
        <a class="file" href="./README.md">
          <h3>README.md</h3>
          <p>Project summary & documentation (Markdown)</p>
        </a>
        <a class="file" href="./Retail-Net-Zero-Case-Study.pptx">
          <h3>Retail-Net-Zero-Case-Study.pptx</h3>
          <p>Final presentation deck (PowerPoint)</p>
        </a>
        <a class="file" href="./Task/CORE_Markets_Intern_Analyst_Case_Study_2025.pdf">
          <h3>Task - Brief</h3>
          <p>Official task brief (PDF)</p>
        </a>
        <a class="file" href="./Task/CORE_Markets_Intern_Analyst_Case_Study_Data_2025.xlsx">
          <h3>Task - Data</h3>
          <p>Raw dataset (Excel)</p>
        </a>
      </div>
    </section>

    <div class="hr"></div>

    <!-- README will be rendered here -->
    <section id="readme" class="content card">
      <noscript>
        <p><strong>Note:</strong> Enable JavaScript to view the rendered README. You can still open it directly:
          <a href="./README.md">README.md</a>.</p>
      </noscript>
    </section>

    <footer>
      <div class="hr"></div>
      © <span id="year"></span> Liam Davis
    </footer>
  </div>

  <!-- Markdown renderer + (optional) sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- DOMPurify without SRI (avoids hash mismatch errors); safe fallback if it fails to load -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Fetch and render README.md from THIS folder
    (async function renderReadme() {
      try {
        const res = await fetch('./README.md', { cache: 'no-store' });
        if (!res.ok) throw new Error(`README fetch failed: ${res.status} ${res.statusText}`);
        const md = await res.text();
        marked.setOptions({ breaks: true, mangle: false, headerIds: true });
        const rawHtml = marked.parse(md);
        // Sanitize if DOMPurify loaded; else insert as-is
        const safeHtml = (window.DOMPurify && DOMPurify.sanitize) ? DOMPurify.sanitize(rawHtml) : rawHtml;
        document.getElementById('readme').innerHTML = safeHtml;

        // Fix any root-leading links in the rendered README
        normalizeLinks('#readme');
      } catch (err) {
        console.error(err);
        document.getElementById('readme').innerHTML =
          '<p>Could not load README.md from this folder. You can open it directly: <a href="./README.md">README.md</a>.</p>';
      }
    })();

    // Convert root-leading links (/foo) to work relative to this folder; encode spaces
    function normalizeLinks(scopeSelector) {
      var baseHref = document.baseURI; // current folder (thanks to <base>)
      document.querySelectorAll(scopeSelector + ' a[href]').forEach(function (a) {
        var href = a.getAttribute('href') || '';
        if (/^[a-z]+:/i.test(href) || href.startsWith('#')) return; // external/mailto/hash
        href = href.replace(/ /g, '%20');
        if (href.startsWith('/')) href = href.slice(1); // drop leading slash
        a.setAttribute('href', new URL(href, baseHref).toString());
      });
    }
  </script>
</body>
</html>